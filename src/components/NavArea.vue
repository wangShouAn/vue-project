<script setup>
import { ref, onMounted, onUnmounted, computed, watchEffect } from 'vue'

const logo =
  'https://my.tcb-life.com.tw/assets/%E5%90%88%E5%BA%AB%E4%BA%BA%E5%A3%BDLOGO-BPgS4Q-a.svg'

const navItems = ref([
  {
    open: false,
    name: '‰øùÊà∂ÊúçÂãô',
    img: 'https://my.tcb-life.com.tw/api/assets/2a009399-4329-4913-98f4-e7e896c4c17f',
    item: [
      [
        { text: 'Âà©ÁéáÁúãÊùø', type: 'link' },
        { text: 'ÂåØÁéáË≥áË®ä', type: 'link' },
        { text: 'ÈõªÂ≠êÂñÆÊìöÊúçÂãô', type: 'link' },
        { text: 'Ë°åÂãïË∫´ÂàÜË≠òÂà•Ë∫´ÂàÜË™çË≠âÊúçÂãô', type: 'link' },
        { text: 'Â§ñ‰æÜ‰∫∫Âè£„ÄåÊñ∞ÂºèÁµ±‰∏ÄË≠âËôü„ÄçÂ∞àÂçÄ', type: 'link' },
      ],
      [
        { text: 'Ë°®ÂñÆ‰∏ãËºâ', type: 'link' },
        { text: '‰øùÊà∂Â∞àÂçÄ', type: 'link' },
        { text: 'Â∏∏Ë¶ãÂïèÈ°å', type: 'link' },
        { text: 'ËÅØÁµ°ÊàëÂÄë', type: 'link' },
        { text: 'Â∞ä‰∫´VIP', type: 'link' },
        { text: 'Âêà‰ΩúÈáëÂ∫´‰∫∫Â£ΩAPPÂ∞àÂçÄ', type: 'link' },
      ],
      [
        {
          text: 'Â•ëÁ¥ÑËÆäÊõ¥‰ΩúÊ•≠',
          type: 'title',
          item: [
            { text: 'Â•ëÁ¥ÑËÆäÊõ¥', type: 'link' },
            { text: '‰øùÂÖ®ËÅØÁõüÈèàÊúçÂãô', type: 'link' },
          ],
        },
        { text: '‰øùËèØÂº∑Âà∂Âü∑Ë°åÂ∞àÂçÄ', type: 'link' },
      ],
      [
        {
          text: 'ÁêÜË≥†ÊúçÂãô',
          type: 'title',
          item: [
            { text: '‰øùÂñÆÁêÜË≥†', type: 'link' },
            { text: 'ÁêÜË≥†ËÅØÁõüÊúçÂãô', type: 'link' },
            { text: 'ÁêÜË≥†ÈÜ´Ëµ∑ÈÄöÊúçÂãô', type: 'link' },
          ],
        },
      ],
    ],
  },
  { open: false, name: 'ÂÆâÂøÉÂÆàË≠∑' },
  {
    open: false,
    name: 'ÊâÄÊúâÂïÜÂìÅ',
    img: 'https://my.tcb-life.com.tw/api/assets/18634038-b350-4491-b36b-ee18adbaea0b',
    item: [
      [
        { text: 'ÁÜ±ÈñÄÂïÜÂìÅ', type: 'link' },
        { text: 'ÊäïË≥áÂûã‰øùÈö™', type: 'link' },
        { text: 'Â£ΩÈö™', type: 'link' },
        { text: 'ÊÑèÂ§ñÂÇ∑ÂÆ≥‰øùÈö™', type: 'link' },
        { text: 'ÂÅ•Â∫∑ÈÜ´ÁôÇ‰øùÈö™', type: 'link' },
        { text: 'ÊàøË≤∏Âûã‰øùÈö™', type: 'link' },
      ],
      [
        { text: 'ÈôÑÂä†ËàáÊâπË®ªÊ¢ùÊ¨æ', type: 'link' },
        { text: 'Á∂≤Ë∑ØÊäï‰øùÂïÜÂìÅ', type: 'link' },
        { text: 'ÈõªË©±Ë°åÈä∑ÂïÜÂìÅ', type: 'link' },
        {
          text: 'ÈäÄË°åÊäï‰øùÂïÜÂìÅ',
          type: 'title',
          item: [
            { text: 'ÂÇ≥ÈÄÅÂûãÂïÜÂìÅ', type: 'link' },
            { text: 'ÊäïË≥áÂûãÂïÜÂìÅ', type: 'link' },
            { text: 'ÊàøË≤∏ÂûãÂïÜÂìÅ', type: 'link' },
          ],
        },
      ],
    ],
  },
  {
    open: false,
    name: 'ÂÖ¨Âπ≥ÂæÖÂÆ¢',
    img: 'https://my.tcb-life.com.tw/api/assets/7d15c00b-e668-4e88-a314-64007642b2aa',
    item: [
      [
        {
          text: 'ÂÖ¨Âπ≥ÂæÖÂÆ¢ÁêÜÂøµ',
          type: 'title',
          item: [
            { text: 'Á∏ΩÁ∂ìÁêÜÁöÑË©±', type: 'link' },
            { text: 'ÂÖ¨Âπ≥ÂæÖÂÆ¢ÂçÅÂ§ßÂéüÂâá', type: 'link' },
            { text: 'ËêΩÂØ¶ÂÖ¨Âπ≥ÂæÖÂÆ¢Êé™ÊñΩ', type: 'link' },
          ],
        },
        {
          text: 'ÂèãÂñÑÊúçÂãô',
          type: 'title',
          item: [
            { text: 'ÁÑ°ÈöúÁ§ôÁ∂≤Á´ô', type: 'link' },
            { text: 'ÈáëËûçÂèãÂñÑÊúçÂãô', type: 'link' },
            { text: 'ÂèãÂñÑÊúçÂãôÁõ∏ÈóúË®äÊÅØ', type: 'link' },
          ],
        },
      ],
      [
        {
          text: 'ÊÑüÂãïËàáÊàêÂ∞±',
          type: 'title',
          item: [
            { text: 'ÂÖ¨ÁõäÊ¥ªÂãïÁ¥ÄÈåÑ', type: 'link' },
            { text: 'ÂÆâÂøÉÂÆàË≠∑', type: 'link' },
            { text: 'Ê∞∏Á∫åÁôºÂ±ï', type: 'link' },
          ],
        },
        { text: 'Ê®ÇÈΩ°Â∞àÂçÄ', type: 'link' },
        { text: 'Èò≤Ë©êÂ∞àÂçÄ', type: 'link' },
      ],
    ],
  },
  {
    open: false,
    name: '‰øùÈö™Áü•Ë≠òÂ∫´',
    img: 'https://my.tcb-life.com.tw/api/assets/37cf93be-3d13-4f68-becf-b8c9ad76b1c5',
    item: [
      [
        { text: 'ÂΩ±Èü≥Â∞àÂçÄ', type: 'link' },
        { text: 'ÈáëËûçÂ∞èÂ∏∏Ë≠ò', type: 'link' },
      ],
    ],
  },
  {
    open: false,
    name: 'ÈóúÊñºÊàëÂÄë',
    img: 'https://my.tcb-life.com.tw/api/assets/0a55befe-f8aa-43ce-b8b3-8d63b54807df',
    item: [
      [
        { text: 'Âêà‰ΩúÈáëÂ∫´‰∫∫Â£ΩÁ∞°‰ªã', type: 'link' },
        { text: 'È¶ñÈï∑Ë≥áÊñô', type: 'link' },
        { text: 'ÂæóÁçéÁ¥ÄÈåÑ', type: 'link' },
        { text: '‰ø°Áî®Ë©ïÂÉπ', type: 'link' },
        { text: 'ËÅØÁµ°ÊàëÂÄë', type: 'link' },
        { text: 'ÂÖ¨ÁõäÂíñÂï°', type: 'link' },
      ],
      [
        { text: 'Ê∞∏Á∫åÁôºÂ±ï', type: 'link' },
        { text: 'Âêà‰ΩúÈáëÊéß', type: 'link' },
        { text: 'Âêà‰ΩúÈáëÊéßÊ∞∏Á∫åÁôºÂ±ï', type: 'link' },
        { text: 'Ê≥ïÂïÜÊ≥ïÂúãÂ∑¥Èªé‰øùÈö™ÊéßËÇ°ÂÖ¨Âè∏', type: 'link' },
        { text: 'Èóú‰øÇ‰ºÅÊ•≠', type: 'link' },
      ],
    ],
  },
])

const isSearchOpen = ref(false)

const isMobile = ref(false)

function openMenu(index) {
  navItems.value.forEach((item) => {
    item.open = false
  })
  navItems.value[index].open = true
}
function closeMenu() {
  navItems.value.forEach((item) => {
    item.open = false
  })
}

const isVisible = ref(false)

function handleScroll() {
  isVisible.value = window.scrollY > 0
}

onMounted(() => {
  window.addEventListener('scroll', handleScroll)
  window.addEventListener('resize', () => {
    isMobile.value = window.innerWidth < 768
  })
})

onUnmounted(() => {
  window.removeEventListener('scroll', handleScroll)
  window.removeEventListener('resize', () => {
    isMobile.value = window.innerWidth < 768
  })
})

function toggleSearch() {
  isSearchOpen.value = !isSearchOpen.value
}
</script>

<template>
  <cus-container v-if="!isMobile">
    <div>
      <img
        src="data:image/svg+xml,%3csvg%20width='24'%20height='25'%20viewBox='0%200%2024%2025'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M12%2020.625C12.2875%2020.625%2013.0538%2020.3425%2013.8588%2018.7325C14.2413%2017.9675%2014.5625%2017.02%2014.7863%2015.9375H9.21375C9.4375%2017.02%209.75875%2017.9675%2010.1412%2018.7325C10.9462%2020.3425%2011.7125%2020.625%2012%2020.625ZM8.9425%2014.0625C8.85191%2013.0228%208.85191%2011.9772%208.9425%2010.9375H15.0575C15.1475%2011.9772%2015.1475%2013.0228%2015.0575%2014.0625H8.9425ZM16.6962%2015.9375C16.4163%2017.4675%2015.955%2018.8225%2015.3638%2019.8975C17.1244%2019.0935%2018.5421%2017.69%2019.3638%2015.9375H16.6962ZM19.975%2014.0625H16.9375C17.019%2013.0224%2017.019%2011.9776%2016.9375%2010.9375H19.9737C20.176%2011.9694%2020.176%2013.0306%2019.9737%2014.0625H19.975ZM7.06125%2014.0625H4.025C3.82279%2013.0306%203.82279%2011.9694%204.025%2010.9375H7.0625C6.981%2011.9776%206.981%2013.0224%207.0625%2014.0625H7.06125ZM4.63625%2015.9375H7.30375C7.58375%2017.4675%208.045%2018.8225%208.63625%2019.8975C6.87558%2019.0935%205.4579%2017.69%204.63625%2015.9375ZM9.21375%209.0625H14.7863C14.5625%207.98%2014.2413%207.0325%2013.8588%206.2675C13.0538%204.6575%2012.2875%204.375%2012%204.375C11.7125%204.375%2010.9462%204.6575%2010.1412%206.2675C9.75875%207.0325%209.4375%207.98%209.21375%209.0625ZM16.6962%209.0625H19.3638C18.5421%207.30999%2017.1244%205.90649%2015.3638%205.1025C15.955%206.1775%2016.4163%207.5325%2016.6962%209.0625ZM8.6375%205.1025C8.04625%206.1775%207.585%207.5325%207.305%209.0625H4.63625C5.4579%207.30999%206.87683%205.90649%208.6375%205.1025ZM12%202.5C14.6522%202.5%2017.1957%203.55357%2019.0711%205.42893C20.9464%207.3043%2022%209.84784%2022%2012.5C22%2015.1522%2020.9464%2017.6957%2019.0711%2019.5711C17.1957%2021.4464%2014.6522%2022.5%2012%2022.5C9.34784%2022.5%206.8043%2021.4464%204.92893%2019.5711C3.05357%2017.6957%202%2015.1522%202%2012.5C2%209.84784%203.05357%207.3043%204.92893%205.42893C6.8043%203.55357%209.34784%202.5%2012%202.5Z'%20fill='%23008E6A'/%3e%3c/svg%3e"
      />
      <span>EN</span>
    </div>
    <a href="#">‰øùË≠∑Â∞àÂçÄ</a>
    <a href="#">ÁêÜÂ∞àÂ∞àÂçÄ</a>
  </cus-container>
  <nav :class="{ isVisible: !isVisible }" v-if="!isMobile">
    <img :src="logo" />
    <ul>
      <li v-for="(item, index) in navItems" :key="index">
        <button @mouseenter="openMenu(index)">
          {{ item.name }}
        </button>
        <menu @mouseleave="closeMenu()" v-if="item.open && item.item">
          <img v-if="item.img" :src="item.img" />

          <ul v-for="(subItems, subIndex) in item.item" :key="subIndex">
            <li v-for="(subItem, i) in subItems" :key="i">
              <a v-if="subItem.type === 'link'" :href="subItem.text">{{ subItem.text }}</a>
              <div v-else-if="subItem.type === 'title'">
                <p>{{ subItem.text }}</p>
                <div>
                  <template v-for="(subSubItem, si) in subItem.item" :key="si">
                    <a :href="subSubItem.text">{{ subSubItem.text }} </a>
                    <br />
                  </template>
                </div>
              </div>
            </li>
          </ul>
        </menu>
      </li>
      <li>
        <button id="search" @click="toggleSearch">ü§î</button>

        <searchMenu v-if="isSearchOpen">
          <h2>ÈóúÈçµÂ≠óÊêúÂ∞ã</h2>
          <div>
            <input type="text" placeholder="Ë´ãËº∏ÂÖ•ÈóúÈçµÂ≠ó" />
            <button>ü§î</button>
          </div>
        </searchMenu>
      </li>
    </ul>
  </nav>

  <nav2 :class="{ isVisible: isVisible }" v-else>
    <button>‰∏â</button>
    <img :src="logo" />
    <p></p>
  </nav2>
  <searchback @click.self="toggleSearch" v-if="isSearchOpen" />
</template>
<style lang="scss" scoped>
cus-container {
  div {
    display: flex;
    align-items: center;
  }
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 20vw;
  height: 2vw;
  padding: 1vw;
  border-bottom-left-radius: 1vw;
  border-bottom-right-radius: 1vw;
  color: #008e6a;
  position: sticky;
  top: 0;
  left: 66vw;
  background-color: #d6f0ea;
  z-index: 99999;
  font-weight: bold;
  a {
    color: #008e6a;
    text-decoration: none;
  }
  span {
    margin: 0;
    padding: 0;
  }
}
nav2 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 8vw;
  background-color: #fff;
  box-shadow: 0 0 1vw rgba(0, 0, 0, 0.4);
  position: sticky;
  top: 1vw;
  left: 0;
  z-index: 9999;
  margin-top: 1vw;
  border-radius: 4vw;
  width: 90vw;
  transform: translateX(2%);

  padding: 0 3vw;
  img {
    width: 25vw;
  }
  p {
    font-size: 1vw;
    color: #000;
    margin: 0;
    margin-left: 1vw;
  }
  button {
    background-color: #00000000;
    border: none;
    font-size: 3vw;
    color: #000;
    margin: 0;
    margin-right: 1vw;
    cursor: pointer;
  }
}
nav {
  &.isVisible {
    box-shadow: none;
    background-color: #00000000;
  }
  transition: all 1s linear;
  box-shadow: 0 0 1vw rgba(0, 0, 0, 0.4);
  width: 75%;
  display: flex;
  justify-content: space-around;
  align-items: center;
  height: 5vw;
  background-color: #fff;
  position: sticky;
  top: 4vw;
  left: 50%;
  z-index: 9999;
  margin-top: 1vw;
  border-radius: 4vw;
  transform: translateX(-17%);
  img {
    width: 16vw;
  }
  ul {
    display: flex;
    li {
      list-style: none;
      button {
        overflow: hidden;
        text-align: center;
        white-space: nowrap;
        text-overflow: ellipsis;
        background-color: #fff;
        border: none;
        border-radius: 0.5vw;
        padding: 1vw;
        margin: 0 0.5vw;
        font-size: 1vw;
        cursor: pointer;
        &:hover {
          background-color: #008e6a;
          color: #fff;
        }
      }
      menu {
        box-sizing: border-box;
        overflow-x: scroll;
        display: flex;
        position: fixed;
        width: 80vw;
        height: auto;
        min-height: 30vw;
        top: 5vw;
        left: 50%;
        transform: translateX(-50%);

        background-color: white;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        border-radius: 2vw;
        padding: 2vw;
        img {
          width: 20vw;
          height: 15vw;
          border-radius: 2vw;
        }
        ul {
          display: flex;
          flex-direction: column;

          li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1vw 0;
            a {
              width: 15vw;
              color: #000;
              font-size: 1.5vw;
              text-decoration: none;
              &:hover {
                text-decoration: underline;
              }
            }
            div {
              margin: 0;
              padding: 0;
              display: flex;
              flex-direction: column;
              p {
                margin: 0;
                margin-bottom: 2vw;
                padding: 0;
                font-size: 1.5vw;
                color: #000;
              }
              a {
                margin-bottom: 2vw;
                color: #666;
              }
            }
          }
        }
      }
    }
  }
}
#search {
  &:hover {
    background-color: #00000000;
  }
}
searchMenu {
  padding: 1vw;
  position: absolute;
  display: block;
  top: 5vw;
  width: 35vw;
  transform: translateX(-85%);
  border-radius: 1vw;
  overflow: hidden;
  background-color: #fff;
  border: 1px solid #aaa;
  h2 {
    font-size: 2vw;
    margin: 0;
    margin-bottom: 2vw;
  }
  div {
    position: relative;
  }
  button {
    position: absolute;
    top: 10%;
    right: 0;
    padding: 1vw;
    font-size: 1.5vw;
    background-color: #fff;
    border: none;
    cursor: pointer;
  }
  input {
    all: unset;
    border-radius: 2vw;
    box-sizing: border-box;
    width: 100%;
    padding: 1vw;
    font-size: 1.5vw;
    border: #aaa 1px solid;
    margin-bottom: 1vw;
  }
}
searchback {
  width: 100%;
  height: 100%;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9998;
}
</style>
