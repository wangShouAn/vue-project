<script setup>
import { ref, onMounted, onUnmounted } from 'vue'

const logo =
  'https://my.tcb-life.com.tw/assets/%E5%90%88%E5%BA%AB%E4%BA%BA%E5%A3%BDLOGO-BPgS4Q-a.svg'

const navItems = ref([
  {
    open: false,
    name: '‰øùÊà∂ÊúçÂãô',
    img: 'https://my.tcb-life.com.tw/api/assets/2a009399-4329-4913-98f4-e7e896c4c17f',
    item: [
      [
        { text: 'Âà©ÁéáÁúãÊùø', type: 'link' },
        { text: 'ÂåØÁéáË≥áË®ä', type: 'link' },
        { text: 'ÈõªÂ≠êÂñÆÊìöÊúçÂãô', type: 'link' },
        { text: 'Ë°åÂãïË∫´ÂàÜË≠òÂà•Ë∫´ÂàÜË™çË≠âÊúçÂãô', type: 'link' },
        { text: 'Â§ñ‰æÜ‰∫∫Âè£„ÄåÊñ∞ÂºèÁµ±‰∏ÄË≠âËôü„ÄçÂ∞àÂçÄ', type: 'link' },
      ],
      [
        { text: 'Ë°®ÂñÆ‰∏ãËºâ', type: 'link' },
        { text: '‰øùÊà∂Â∞àÂçÄ', type: 'link' },
        { text: 'Â∏∏Ë¶ãÂïèÈ°å', type: 'link' },
        { text: 'ËÅØÁµ°ÊàëÂÄë', type: 'link' },
        { text: 'Â∞ä‰∫´VIP', type: 'link' },
        { text: 'Âêà‰ΩúÈáëÂ∫´‰∫∫Â£ΩAPPÂ∞àÂçÄ', type: 'link' },
      ],
      [
        {
          text: 'Â•ëÁ¥ÑËÆäÊõ¥‰ΩúÊ•≠',
          type: 'title',
          item: [
            { text: 'Â•ëÁ¥ÑËÆäÊõ¥', type: 'link' },
            { text: '‰øùÂÖ®ËÅØÁõüÈèàÊúçÂãô', type: 'link' },
          ],
        },
        { text: '‰øùËèØÂº∑Âà∂Âü∑Ë°åÂ∞àÂçÄ', type: 'link' },
      ],
    ],
  },
  { open: false, name: 'ÂÆâÂøÉÂÆàË≠∑' },
  {
    open: false,
    name: 'ÊâÄÊúâÂïÜÂìÅ',
    img: 'https://my.tcb-life.com.tw/api/assets/18634038-b350-4491-b36b-ee18adbaea0b',
    item: [
      [
        { text: 'ÁÜ±ÈñÄÂïÜÂìÅ', type: 'link' },
        { text: 'ÊäïË≥áÂûã‰øùÈö™', type: 'link' },
        { text: 'Â£ΩÈö™', type: 'link' },
        { text: 'ÊÑèÂ§ñÂÇ∑ÂÆ≥‰øùÈö™', type: 'link' },
        { text: 'ÂÅ•Â∫∑ÈÜ´ÁôÇ‰øùÈö™', type: 'link' },
        { text: 'ÊàøË≤∏Âûã‰øùÈö™', type: 'link' },
      ],
      [
        { text: 'ÈôÑÂä†ËàáÊâπË®ªÊ¢ùÊ¨æ', type: 'link' },
        { text: 'Á∂≤Ë∑ØÊäï‰øùÂïÜÂìÅ', type: 'link' },
        { text: 'ÈõªË©±Ë°åÈä∑ÂïÜÂìÅ', type: 'link' },
        {
          text: 'ÈäÄË°åÊäï‰øùÂïÜÂìÅ',
          type: 'title',
          item: [
            { text: 'ÂÇ≥ÈÄÅÂûãÂïÜÂìÅ', type: 'link' },
            { text: 'ÊäïË≥áÂûãÂïÜÂìÅ', type: 'link' },
            { text: 'ÊàøË≤∏ÂûãÂïÜÂìÅ', type: 'link' },
          ],
        },
      ],
    ],
  },
  {
    open: false,
    name: 'ÂÖ¨Âπ≥ÂæÖÂÆ¢',
    img: 'https://my.tcb-life.com.tw/api/assets/7d15c00b-e668-4e88-a314-64007642b2aa',
    item: [
      [
        {
          text: 'ÂÖ¨Âπ≥ÂæÖÂÆ¢ÁêÜÂøµ',
          type: 'title',
          item: [
            { text: 'Á∏ΩÁ∂ìÁêÜÁöÑË©±', type: 'link' },
            { text: 'ÂÖ¨Âπ≥ÂæÖÂÆ¢ÂçÅÂ§ßÂéüÂâá', type: 'link' },
            { text: 'ËêΩÂØ¶ÂÖ¨Âπ≥ÂæÖÂÆ¢Êé™ÊñΩ', type: 'link' },
          ],
        },
        {
          text: 'ÂèãÂñÑÊúçÂãô',
          type: 'title',
          item: [
            { text: 'ÁÑ°ÈöúÁ§ôÁ∂≤Á´ô', type: 'link' },
            { text: 'ÈáëËûçÂèãÂñÑÊúçÂãô', type: 'link' },
            { text: 'ÂèãÂñÑÊúçÂãôÁõ∏ÈóúË®äÊÅØ', type: 'link' },
          ],
        },
      ],
      [
        {
          text: 'ÊÑüÂãïËàáÊàêÂ∞±',
          type: 'title',
          item: [
            { text: 'ÂÖ¨ÁõäÊ¥ªÂãïÁ¥ÄÈåÑ', type: 'link' },
            { text: 'ÂÆâÂøÉÂÆàË≠∑', type: 'link' },
            { text: 'Ê∞∏Á∫åÁôºÂ±ï', type: 'link' },
          ],
        },
        { text: 'Ê®ÇÈΩ°Â∞àÂçÄ', type: 'link' },
        { text: 'Èò≤Ë©êÂ∞àÂçÄ', type: 'link' },
      ],
    ],
  },
  {
    open: false,
    name: '‰øùÈö™Áü•Ë≠òÂ∫´',
    img: 'https://my.tcb-life.com.tw/api/assets/37cf93be-3d13-4f68-becf-b8c9ad76b1c5',
    item: [
      [
        { text: 'ÂΩ±Èü≥Â∞àÂçÄ', type: 'link' },
        { text: 'ÈáëËûçÂ∞èÂ∏∏Ë≠ò', type: 'link' },
      ],
    ],
  },
  {
    open: false,
    name: 'ÈóúÊñºÊàëÂÄë',
    img: 'https://my.tcb-life.com.tw/api/assets/0a55befe-f8aa-43ce-b8b3-8d63b54807df',
    item: [
      [
        { text: 'Âêà‰ΩúÈáëÂ∫´‰∫∫Â£ΩÁ∞°‰ªã', type: 'link' },
        { text: 'È¶ñÈï∑Ë≥áÊñô', type: 'link' },
        { text: 'ÂæóÁçéÁ¥ÄÈåÑ', type: 'link' },
        { text: '‰ø°Áî®Ë©ïÂÉπ', type: 'link' },
        { text: 'ËÅØÁµ°ÊàëÂÄë', type: 'link' },
        { text: 'ÂÖ¨ÁõäÂíñÂï°', type: 'link' },
      ],
      [
        { text: 'Ê∞∏Á∫åÁôºÂ±ï', type: 'link' },
        { text: 'Âêà‰ΩúÈáëÊéß', type: 'link' },
        { text: 'Âêà‰ΩúÈáëÊéßÊ∞∏Á∫åÁôºÂ±ï', type: 'link' },
        { text: 'Ê≥ïÂïÜÊ≥ïÂúãÂ∑¥Èªé‰øùÈö™ÊéßËÇ°ÂÖ¨Âè∏', type: 'link' },
        { text: 'Èóú‰øÇ‰ºÅÊ•≠', type: 'link' },
      ],
    ],
  },
])

const isSearchOpen = ref(false)

function openMenu(index) {
  navItems.value.forEach((item) => {
    item.open = false
  })
  navItems.value[index].open = true
}
function closeMenu() {
  navItems.value.forEach((item) => {
    item.open = false
  })
}

const isVisible = ref(false)

function handleScroll() {
  isVisible.value = window.scrollY > 0
}

onMounted(() => {
  window.addEventListener('scroll', handleScroll)
})

onUnmounted(() => {
  window.removeEventListener('scroll', handleScroll)
})

function toggleSearch() {
  isSearchOpen.value = !isSearchOpen.value
}
</script>

<template>
  <nav :class="{ isVisible: !isVisible }">
    <img :src="logo" />
    <ul>
      <li v-for="(item, index) in navItems" :key="index">
        <button @mouseenter="openMenu(index)">
          {{ item.name }}
        </button>
        <menu @mouseleave="closeMenu()" v-if="item.open && item.item">
          <img v-if="item.img" :src="item.img" />

          <ul v-for="(subItems, subIndex) in item.item" :key="subIndex">
            <li v-for="(subItem, i) in subItems" :key="i">
              <a v-if="subItem.type === 'link'" :href="subItem.text">{{ subItem.text }}</a>
              <div v-else-if="subItem.type === 'title'">
                <p>{{ subItem.text }}</p>
                <div>
                  <template v-for="(subSubItem, si) in subItem.item" :key="si">
                    <a>{{ subSubItem.text }} </a>
                    <br />
                  </template>
                </div>
              </div>
            </li>
          </ul>
        </menu>
      </li>
      <li>
        <button id="search" @click="toggleSearch">ü§î</button>

        <searchMenu v-if="isSearchOpen">
          <h2>ÈóúÈçµÂ≠óÊêúÂ∞ã</h2>
          <div>
            <input type="text" placeholder="Ë´ãËº∏ÂÖ•ÈóúÈçµÂ≠ó" />
            <button>ü§î</button>
          </div>
        </searchMenu>
      </li>
    </ul>
  </nav>
  <searchback @click.self="toggleSearch" v-if="isSearchOpen" />
</template>
<style lang="scss" scoped>
nav {
  &.isVisible {
    box-shadow: none;
  }
  transition: all 1s linear;
  box-shadow: 0 0 1vw rgba(0, 0, 0, 0.4);
  width: 75%;
  display: flex;
  justify-content: space-around;
  align-items: center;
  height: 5vw;
  background-color: #fff;
  position: sticky;
  top: 2vw;
  left: 50%;
  z-index: 9999;
  margin-top: 1vw;
  border-radius: 4vw;
  transform: translateX(-15%);
  img {
    width: 16vw;
  }
  ul {
    display: flex;
    li {
      list-style: none;
      button {
        overflow: hidden;
        text-align: center;
        white-space: nowrap;
        text-overflow: ellipsis;
        background-color: #fff;
        border: none;
        border-radius: 0.5vw;
        padding: 1vw;
        margin: 0 0.5vw;
        font-size: 1vw;
        cursor: pointer;
        &:hover {
          background-color: #008e6a;
          color: #fff;
        }
      }
      menu {
        box-sizing: border-box;
        overflow-x: scroll;
        display: flex;
        position: fixed;
        width: 80vw;
        height: auto;
        min-height: 30vw;
        top: 5vw;
        left: 50%;
        transform: translateX(-50%);

        background-color: white;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        border-radius: 2vw;
        padding: 2vw;
        img {
          width: 20vw;
          height: 15vw;
          border-radius: 2vw;
        }
        ul {
          display: flex;
          flex-direction: column;

          li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1vw 0;
            a {
              width: 15vw;
              color: #000;
              font-size: 1.5vw;
              text-decoration: none;
              &:hover {
                text-decoration: underline;
              }
            }
            div {
              margin: 0;
              padding: 0;
              display: flex;
              flex-direction: column;
              p {
                margin: 0;
                margin-bottom: 2vw;
                padding: 0;
                font-size: 1.5vw;
                color: #000;
              }
              a {
                margin-bottom: 2vw;
                color: #666;
              }
            }
          }
        }
      }
    }
  }
}
#search {
  &:hover {
    background-color: #00000000;
  }
}
searchMenu {
  padding: 1vw;
  position: absolute;
  display: block;
  top: 5vw;
  width: 35vw;
  transform: translateX(-85%);
  border-radius: 1vw;
  overflow: hidden;
  background-color: #fff;
  border: 1px solid #000;
  h2 {
    font-size: 2vw;
    margin: 0;
    margin-bottom: 2vw;
  }
  div {
    position: relative;
  }
  button {
    position: absolute;
    top: 10%;
    right: 0;
    padding: 1vw;
    font-size: 1.5vw;
    background-color: #fff;
    border: none;
    cursor: pointer;
  }
  input {
    all: unset;
    box-sizing: border-box;
    width: 100%;
    padding: 1vw;
    font-size: 1.5vw;
    border: #aaa 1px solid;

    margin-bottom: 1vw;
  }
}
searchback {
  width: 100%;
  height: 100%;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9998;
}
</style>
